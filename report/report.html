<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Webtech Report</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<!-- html,NoFonts --> 
<meta name="src" content="report.tex"> 
<<<<<<< HEAD
<meta name="date" content="2016-05-29 23:17:00"> 
=======
<meta name="date" content="2016-05-29 23:21:00"> 
>>>>>>> 4f087a60b1801f41fbbb7c7f81056056e8f4f5af
<link rel="stylesheet" type="text/css" href="report.css"> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class="titleHead">Webtech Report</h2>
<div class="author" >Imna Malik n James Sewart</div><br />
<div class="date" >29-5-16</div>
   </div>
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">Client</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.1 <a 
href="#x1-30001.1" id="QQ2-1-3">Style</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.1 <a 
href="#x1-40001.1.1" id="QQ2-1-4">General Layout</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.2 <a 
href="#x1-50001.1.2" id="QQ2-1-6">Base Classes</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.3 <a 
href="#x1-60001.1.3" id="QQ2-1-7">Resizing</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.4 <a 
href="#x1-70001.1.4" id="QQ2-1-9">Info Panel</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.5 <a 
href="#x1-80001.1.5" id="QQ2-1-11">Search Panel</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.6 <a 
href="#x1-90001.1.6" id="QQ2-1-12">Map</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.2 <a 
href="#x1-100001.2" id="QQ2-1-13">Logic</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-110002" id="QQ2-1-14">Server</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-120003" id="QQ2-1-15">Deployment</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-130004" id="QQ2-1-16">API Usage</a></span>
   </div>
   <div 
class="abstract" 
>
<div class="center" 
>
<!--l. 45--><p class="noindent" >
<!--l. 45--><p class="noindent" >Abstract</div>
<!--l. 45--><p class="noindent" >
     <!--l. 46--><p class="indent" >    visual music discovery service using data crawled from various apis and
     combined
                                                                  

                                                                  
<<<<<<< HEAD
     <!--l. 46--><p class="indent" >    The <a 
href="https://smple.uk" >Smple</a> (short for sample) web application is a visual music discovery
     service combining the data crawled from various APIs
=======
>>>>>>> 4f087a60b1801f41fbbb7c7f81056056e8f4f5af
</div>
<!--l. 49--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-20001"></a>Client</h3>
<!--l. 50--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-30001.1"></a>Style</h4>
<!--l. 51--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.1   </span> <a 
 id="x1-40001.1.1"></a>General Layout</h5>
<!--l. 52--><p class="noindent" ><hr class="figure"><div class="figure" 
>
<<<<<<< HEAD
<!--l. 54--><p class="indent" >   The Smple (short for sample) web app consists of a single page which is filled with a
map from the Google Maps API. There are two panels: the search on the left, and the
information (info) on the right.
<!--l. 56--><p class="indent" >   The search panel consists of an input to type a query and two date pickers to choose
the date range for events to be displayed. When a search query is made, results are shown
underneath with the date of the event, the band names that matched, and the time to
walk there.
<!--l. 58--><p class="indent" >   The info panel slides in from the right after selecting an event, either through a map
marker or a search item. It includes one or more circular artist thumbnails at the top
depending on how many artists are playing that event. Underneath is the artist name,
image, and biography for the currently selected artist. Next is an embedded Spotify
player for that artist that is revealed by pressing the play button. Last is the
events venue address and then the link to the ticket-sale site in their individual
panels.
<!--l. 60--><p class="indent" >   The pink markers on the map represent events and the purple marker is the users
current location determined by the browser.
<!--l. 62--><p class="indent" >   The info panel will slide away when the map is moved or zoomed. When the info
panel&#8217;s content overflows the bottom of the page it will be scrollable independent of the
whole page.
<!--l. 65--><p class="noindent" >
=======
                                                                  

                                                                  
<a 
 id="x1-40011"></a>
                                                                  

                                                                  
<!--l. 55--><p class="noindent" >     <img 
src="example1.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;1: </span><span  
class="content">Basic layout description.</span></div><!--tex4ht:label?: x1-40011 -->
                                                                  

                                                                  
<!--l. 57--><p class="noindent" ></div><hr class="endfigure">
<!--l. 59--><p class="indent" >   The web app consists of a single page which is filled with a map using the google
maps api. There are two panels: the search on the left, and the info panel on the
right.
<!--l. 61--><p class="indent" >   The search panel consists of an input to type a query and two date pickers to choose
the date range for events to be displayed. When a search query is made, results are shown
underneath with the date of the event, the band names that matched, and the time to
walk their if available.
<!--l. 63--><p class="indent" >   The info panel slides in from the right when selecting an event, either through a
map marker or a search item. It includes one or more artist thumbnails at the
top depending on how many artists are playing that event. Underneath is the
artist name, image, and biography for the currently selected artist. Next is an
embedded Spotify player for that artist that is revealed by pressing the play button.
Further is information about the events venue and link to the ticket purchasing
page.
<!--l. 65--><p class="indent" >   The pink markers on the map represent events and the purple marker is the users
current location determined by the browser.
<!--l. 67--><p class="indent" >   The info panel will slide away when the map is moved or zooms. When the info panels
content overflows the bottom of the page it will be scrollable independent of the whole
page.
>>>>>>> 4f087a60b1801f41fbbb7c7f81056056e8f4f5af
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.2   </span> <a 
 id="x1-50001.1.2"></a>Base Classes</h5>
<!--l. 71--><p class="noindent" >The design of our layout is inspired by Material Design, using card style boxes. Each
panel is given a shadowbox class which gives the element a border radius, shadow, slight
transparency, and a dark background colour. The search panel and all panels in the info
bar are given this class.
<!--l. 73--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.3   </span> <a 
 id="x1-60001.1.3"></a>Resizing</h5>
<!--l. 74--><p class="noindent" >We use CSS media queries to resize the info panel stuff like the and basically and the
seearch panel thats everything. The font resize thingy we use percentages and ems we
basically use the media query thing we change the font size and have everything inside
percentages so everythings dynamic
<!--l. 76--><p class="indent" >   We use CSS media queries to change large scale layouts based on the screen size.
There are three of these: mobile-sized, large, and extra large. These changes involve
setting the widths of the main panels such that they look good on the screen size. For
the mobile screen this means the panels are full width and stack on top of each other. For
the large size the info bar takes up a third of the screen, and the search 40% of the
screen.
<!--l. 78--><p class="indent" >   For a more dynamic resize control we subscribe to the onresize event of the window
and scale the whole documents font size based on the screen width. Most elements are
defined using ems and so they all scale accordingly. <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-60012"></a>
                                                                  

                                                                  
<!--l. 82--><p class="noindent" >     <img 
src="example3.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;2: </span><span  
class="content">Example layout when rendered using a mobile browser.</span></div><!--tex4ht:label?: x1-60012 -->
                                                                  

                                                                  
<!--l. 84--><p class="indent" >   </div><hr class="endfigure">
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.4   </span> <a 
 id="x1-70001.1.4"></a>Info Panel</h5>
<!--l. 87--><p class="noindent" >The info panel involves many different styling and scripting elements. The panel
is animated in using the css transition property and setting the margin-right
to 0 from -33%. By default moving this panel to the right would bring up a
scrolling bar however this is disallowed by setting overflow to hidden for the
body.
<!--l. 89--><p class="indent" >   In order to get the desired scrolling effect we set the overflow-y to scroll which allows
the contents to scroll within this div. The height is set to 100% of the screen height so
the content will never increase the full page size.
<!--l. 91--><p class="indent" >   The artist thumbnails are contained within an element with text-align set to centre.
Each image is an inline-block which means they overflow and stay centred no matter how
many artists are inserted. As the images they contain could be of any aspect ratio and we
want the thumbnail to be square, we use the object-fit css property to keep the container
box filled with the image inside. The containing box is given a border radius of 50% to
make it circular, and the overflow is set to hidden to crop the image inside. The
thumbnail is animated to zoom on hover using a css selector that transforms the scale of
the container.
<!--l. 93--><p class="indent" >   The missing artist picture was created by importing an image found online into
inkscape with the image rendering mode set to smooth. Then an avatar silhouette was
overlayed on top of it.
<!--l. 95--><p class="indent" >   The second box down includes an element for the artist title, along with a paragraph
tag for the biography. The title is overlayed onto the the artist image and has a
gradient behind in order to make sure the text is visible. The title is pinned
to the bottom of the image. The image width is set to the parents width so
that only the height changes depending on the aspect ratio of the image. this
height will push down the biography. Padding is set on the biography for visual
aesthetic.
<!--l. 97--><p class="indent" >   The next box contains a self made svg that when clicked, triggers a set of
animations. The two triangles will turn 120 degrees with slightly different durations
using SMIL animations, the background colour of the box fades from purple to
grey, and the size of the box increases to reveal an iframe with a spotify player
inside. These animations are reversed on second click to hide the player. when
updating the info panel, the url for the iframe is updated with the current artists
uri, this triggers that url to be loaded inside, causing the correct player to be
displayed.
<!--l. 99--><p class="indent" >   This svg was created using the inkscape polygon tool to make a filled triangle. Then
by duplicating the triangle and enlarging it then excluding we get a stencil triangle. Then
simply by making a same sized triangle and offsetting its psition we get the desired
effect.
<!--l. 101--><p class="indent" >   The final two boxes display information about the venue. The first displays the venue
title and its address. Clicking this will open a new tab with the songkick venue page. The
second box holds another self made svg of tickets. Clicking this will take you to the
                                                                  

                                                                  
songkick ticket purchasing site.
<!--l. 103--><p class="indent" >   Starting with a rectangle we rounded the corners. Making two squares for each end
with rounded corners, we used the difference tool to cut out a semi-circle. By duplicating
a rectangle with rounded corners 5 times and combining them using the combine tool for
simplicity. Using this combined object we exclude the shape from the ticket. Then we
tried duplicating the svg and using the outset tool to make one bigger, then
aligning the two and using the exclusion tool we get the stencil ticket. This
didn&#8217;t quite have the desired shape so instead we scaled the second ticket and
extruded these two. This gives near uniform line thickness. Then by placing
the stencil over a copy of the original and using the difference tool we cut a
shadow. Now by simply placing the stencil in the gap we produced the desired
svg.
<!--l. 105--><p class="indent" >   The background image for the ticket button was taken online and edited using gimp.
First the image was cropped to be square. Using the colour balance tool we adjusted the
shadows, midtones, and highlight to make the pink and blue stand out. Next using the
hue tool we modify the pink to match the websites colour scheme. Other colours were
reduced using this tool. Next using the curve tool we adjust the rgb channels so that the
image is more aesthetically pleasing. Next we created a new pink layer and layer mask for
that layer. Using the gradient tool set to black to white we add a gradient to the
mask which adds a pink gradient to the image. This is done twice, once to add
a pink gradient that is prominent at the top, and one with a black gradient
that is prominent at the bottom to produce a vignette effect. Next using the
fuzzy tool with feathered edges to select the people in the image and using the
hue/saturation tool, the blues were adjusted to be more grey using the overlap setting to
consider overlapping hue values. Next we added the songkick watermark as
an overlapping layer, positioning it in the bottom right layer and resizing as
desired.
<!--l. 107--><p class="indent" >   <hr class="figure"><div class="figure" 
>
                                                                  

                                                                  
<a 
 id="x1-70013"></a>
                                                                  

                                                                  

<!--l. 109--><p class="noindent" ><img 
src="example2.png" alt="PIC"  
>
<br /> <div class="caption" 
><span class="id">Figure&#x00A0;3: </span><span  
class="content">Before and after gimpifying.</span></div><!--tex4ht:label?: x1-70013 -->
                                                                  

                                                                  
<!--l. 111--><p class="indent" >   </div><hr class="endfigure">
<!--l. 114--><p class="indent" >   When a user hovers their mouse over the lower two boxes, an animation is triggered
to dim the image. This is achieved using an anchor html tag that is given the class
boxClickUrl that expands the anchor to cover the entire parent. The dim effect is
achieved by setting the opacity of the image to a smaller value, revealing the black
shadowbox behind.
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.5   </span> <a 
 id="x1-80001.1.5"></a>Search Panel</h5>
<!--l. 117--><p class="noindent" >The search panel consists of a few permanent items. From left to right we have an icon
that is from google material icons custom font. Then we have an input box with
placeholder text to notify the user that it is a search box. Then we have a from and to
date picker using the <a 
href="https://github.com/dbushell/Pikaday" >pikaday</a> library.
<!--l. 119--><p class="indent" >   The items are positioned using the float css attribute to get them next to each
other. Padding is set in various places to get nice spacing and non breaking
space are used to separate the from and to text from their date boxes. For the
labels and date clickers a pointer is set to indicate to the user that they are
clickable.
<!--l. 121--><p class="indent" >   For the result list an empty list container is added for the results of a search to
populate. A border-bottom is added to each list item to act as a separator indication.
Using the css selector last-child we remove the last bottom border so that it only exists
inside the list.
<!--l. 123--><p class="indent" >   A custom date icon was created using two divs, one inside each other with classes red
and white. The javascript that generates these creates the divs and populates them with
a date and month.
<!--l. 125--><p class="indent" >   The date filter uses a library for visualising calendars. Initially this didn&#8217;t work in strict
xhtml mode due to a bug in the library that we have fixed and files a <a 
href="https://github.com/dbushell/Pikaday/pull/526" >pull request</a> for. We
initialise two of these calendars and subscribe to their click events, when a user clicks a
date from the from calendar, we disable choosing date before that date on the to
calendar, and vise versa.
<!--l. 127--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.6   </span> <a 
 id="x1-90001.1.6"></a>Map</h5>
<!--l. 128--><p class="noindent" >The map is from the google maps api with a custom theme set to match the
theme of the site. We use the google map markers for our event visualiser but
add our own custom svg in place of googles. A basic svg marker was found,
and using inkscapes break apart tool, was edited to add a center hole. The
transparency was also modified. The marker is animated using googles marker
settings.
<!--l. 131--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-100001.2"></a>Logic</h4>
                                                                  

                                                                  
<!--l. 132--><p class="noindent" >There exists one script for all the logic of the webapp. We subscribe to the window
onload event as well as the google map callback. In the window load event we setup a
few things, including setting up the callbacks for the svg button, initialising the
websocket to the server, and initialising the date filter boxes.
<!--l. 134--><p class="indent" >   When the map has loaded, we request the browsers location via the google
maps api and setup the markers on the map. After both the map has loaded
and the websocket has loaded we send the user location to the server via the
websocket. This triggers the server to find nearby events to be send back to the
client.
<!--l. 136--><p class="indent" >   When an array of events arrive we populate our internal events array and initialise the
marker for each event. A query is made to find the walking time to each of the events as
well. Once this has happened the user can click on the markers to open up the
information for the event, as well as being able to search for events using the search
bar.
<!--l. 138--><p class="indent" >   When a user clicks a marker, a class is swapped out on the sidebar so that it has a
new margin-right property. As the infopanel has a transition property it will animate in.
The same thing is done with the play button and spotify player but with css properties
background-color and padding-bottom to change the background colour of the play
button and to show the spotify player.
<!--l. 140--><p class="indent" >   When filling the info panel with event information we need to create a thumbnail for
each artist. There can be any number of artists in an event so we create a div
with class bandimage for each artist and append each one to the bandpics div,
organising them properly. The spotify player url is also updated to load the correct
song.
<!--l. 142--><p class="indent" >   For the search bar, the keyup event is subscribed to for the input box so we can get a
string representing the current search each time a new key is pressed. This event is used
to update the search results. First the current query string is used to do a sublime style
fuzzy matching on each of the first and second artist names in every event. The fuzziness
refers to lack of need for sequential characters to match and instead there can be
skips before matching. To visualise the matches the result of the search wraps
each matched character with a bold html tag so that when the search results
are displayed it can be clearly seen which of the artist names characters are
matching.
<!--l. 144--><p class="indent" >   The results from the search include data such as the event date, first and second
artist title, and walking time from the current location. For each result a list element is
created that contains a visualisation of the date, ordering of artist names, and walking
time.
<!--l. 146--><p class="indent" >   These list items are appended to a html list element that exists in the base
html.
<!--l. 148--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-110002"></a>Server</h3>
<!--l. 149--><p class="noindent" >The server uses the provided script with modifications. The index is served as a static file
and dynamic content is achieved using Websocket connections between the client and
                                                                  

                                                                  
server. This design choice simplifies the file resource serving logic, reducing the dynamic
parts to message passing.
<!--l. 151--><p class="indent" >   Once the client has initialised the webpage, it sets up a secure Websocket connection
to the server. A secure socket is preferred as non secure sockets are disallowed when
viewing the page over https. The connection is abstracted into websocket.js such that
server.js can simply pass a callback that is called when a new client query is made, with a
parameter that can be called with the result to send back. server.js doesnt need to worry
about managing connections.
<!--l. 153--><p class="indent" >   The client will query the browser for its current geographical location and when given,
will send this to the server along with a desired date range. The server will reply at some
point in the future with an array of events.
<!--l. 155--><p class="indent" >   The server will receive this data and use it to query the database using a geoNear
query on a <a 
href="https://docs.mongodb.com/manual/core/2dsphere/" >2dsphere</a> index, and a date range query on the event date. The results are
sent to the client.
<!--l. 157--><p class="indent" >   Websockets provide a stream of messages, where a message is either some binary data
or a string. We serialize JSON for sending data between the client and server. When the
client sends its position and desired date range we serialize a data structure that looks
like the following.
                                                                  

                                                                  
   <div class="verbatim" id="verbatim-1">
<span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;{</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;pos:</span><span 
class="cmtt-10">&#x00A0;{</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;lat:</span><span 
class="cmtt-10">&#x00A0;Number,</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;lng:</span><span 
class="cmtt-10">&#x00A0;Number</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;},</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;dateRange:</span><span 
class="cmtt-10">&#x00A0;{</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;from:</span><span 
class="cmtt-10">&#x00A0;Date,</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;to:</span><span 
class="cmtt-10">&#x00A0;Date</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;}</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;}</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span>
</div>
<!--l. 170--><p class="nopar" >
<!--l. 172--><p class="indent" >   Dates aren&#8217;t parsed into JavaScript date objects when using a JSON.parse so these
are handled manually for the database queries.
<!--l. 174--><p class="indent" >   As well as giving the client the desired data we have, we also check whether the
database needs updating. The data is collected using a variety of APIs. First we ask
songkick for the area that the user is in, this allows us to check the database to see if we
have checked this area at all/recently. If we haven&#8217;t got an up to date set of events
for this area, we start downloading the events for the area as well as querying
last.fm for the artists biography and picture, spotify for a reference to their
spotify page, and googles reverse geocode api to get the full address of the
venue.
<!--l. 176--><p class="indent" >   For each area we limit the speed of requests in order to avoid rate limiting. Any
returned errors by the APIs are handled graciously. Once complete data about an event is
retrieved, it is stored in the database using an <a 
href="https://docs.mongodb.com/manual/reference/method/db.collection.update/#upsert-option" >upsert</a> on the event title, to either update
an already queried event, or insert as a new event.
<!--l. 178--><p class="indent" >   A possible optimization of the client-server interaction process would be to determine
what events have already been sent to the client in order to avoid sending them again if
they only scroll the map slightly. This would allow for significantly less data to be
transferred between the two and would avoid reprocessing every event on the client side
on every query change.
<!--l. 181--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-120003"></a>Deployment</h3>
<!--l. 182--><p class="noindent" >The server is written using some ES6 features and so requires a newer version of nodejs
to run. By default the server connects to a local mongojs server with no special
configuration added. This implementation favours root accessible vps&#8217; such as digital
ocean or <a 
href="https://aws.amazon.com/ec2/" >EC2</a>.
<!--l. 184--><p class="indent" >   The development workflow consisted of a digital ocean instance that was setup with a
bare git repo. Git hooks were written so that when a push to the repo is made, a clone of
                                                                  

                                                                  
the repo is updated and a call to npm install is made to update and install any libraries.
On the server the server script is run using <a 
href="https://github.com/remy/nodemon" >nodemon</a> so that when the repo is updated,
the server will restart.
<!--l. 186--><p class="indent" >   This allows very fast staging tests, however this isn&#8217;t suitable for a production run of
the server. The site should be live at <a 
href="https://smple.uk" >https://smple.uk</a>.
<!--l. 188--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-130004"></a>API Usage</h3>
<!--l. 189--><p class="noindent" >As we are using a few public APIs, we needed to take into consideration the terms for
each of these.
<!--l. 191--><p class="indent" >   The songkick API requires attribution when using their data in the form of a graphic
they provide. We accommodated for this by adding their graphic into our ticket purchase
button.
<!--l. 193--><p class="indent" >   Spotify have no requirement for the use of their embedded player as it already
advertising where the player comes from.
<!--l. 195--><p class="indent" >   Last.fm require a link to their site on any information that is retrieved from them, we
get a biography from them in which they include a link to their website so we are covered
here.
    
</body></html> 

                                                                  


