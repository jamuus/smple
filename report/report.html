<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Webtech Report</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<!-- html,NoFonts --> 
<meta name="src" content="report.tex"> 
<meta name="date" content="2016-05-29 16:12:00"> 
<link rel="stylesheet" type="text/css" href="report.css"> 
</head><body 
>
   <div class="maketitle">
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class="titleHead">Webtech Report</h2>
<div class="author" >Imna Malik n James Sewart</div><br />
<div class="date" >29-5-16</div>
   </div>
   <h3 class="likesectionHead"><a 
 id="x1-1000"></a>Contents</h3>
   <div class="tableofcontents">
   <span class="sectionToc" >1 <a 
href="#x1-20001" id="QQ2-1-2">Client</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.1 <a 
href="#x1-30001.1" id="QQ2-1-3">Style</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.1 <a 
href="#x1-40001.1.1" id="QQ2-1-4">Base Classes</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.2 <a 
href="#x1-50001.1.2" id="QQ2-1-5">Resizing</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.3 <a 
href="#x1-60001.1.3" id="QQ2-1-6">General Layout</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.4 <a 
href="#x1-70001.1.4" id="QQ2-1-7">Info Panel</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.5 <a 
href="#x1-80001.1.5" id="QQ2-1-8">Search Panel</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.6 <a 
href="#x1-90001.1.6" id="QQ2-1-9">Date Filter</a></span>
<br />   &#x00A0;&#x00A0;<span class="subsubsectionToc" >1.1.7 <a 
href="#x1-100001.1.7" id="QQ2-1-10">Map</a></span>
<br />   &#x00A0;<span class="subsectionToc" >1.2 <a 
href="#x1-110001.2" id="QQ2-1-11">Logic</a></span>
<br />   <span class="sectionToc" >2 <a 
href="#x1-120002" id="QQ2-1-12">Server</a></span>
<br />   <span class="sectionToc" >3 <a 
href="#x1-130003" id="QQ2-1-13">Deployment</a></span>
<br />   <span class="sectionToc" >4 <a 
href="#x1-140004" id="QQ2-1-14">API</a></span>
   </div>
   <div 
class="abstract" 
>
<div class="center" 
>
<!--l. 45--><p class="noindent" >
<!--l. 45--><p class="noindent" >Abstract</div>
<!--l. 45--><p class="noindent" >
                                                                  

                                                                  
     <!--l. 46--><p class="indent" >    visual music discovery service using data crawled from various apis and
     combined
</div>
<!--l. 51--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-20001"></a>Client</h3>
<!--l. 52--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.1   </span> <a 
 id="x1-30001.1"></a>Style</h4>
<!--l. 53--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.1   </span> <a 
 id="x1-40001.1.1"></a>Base Classes</h5>
<!--l. 54--><p class="noindent" >The design of our layout is inspired by Material Design, using card style boxes. Each
panel is given a shadowbox class which gives the element a border raidus, shadow, slight
tranparency, and a dark background colour. The search panel and all panels in the info
bar are given this class.
<!--l. 56--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.2   </span> <a 
 id="x1-50001.1.2"></a>Resizing</h5>
     <ul class="itemize1">
     <li class="itemize">media queries are used to change various features when the screen size changes
     </li>
     <li class="itemize">there are three main layouts, when the screen is small the search and info
     panel are stacked as they become too squished when side by side
     </li>
     <li class="itemize">this accomodates for mobile users
     </li>
     <li class="itemize">font scaling is acheived by subscribing to the window resize event which allows
     many elements to change size to fit in any screen size</li></ul>
                                                                  

                                                                  
<!--l. 64--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.3   </span> <a 
 id="x1-60001.1.3"></a>General Layout</h5>
     <ul class="itemize1">
     <li class="itemize">whole screen map, fixed
     </li>
     <li class="itemize">hud like overlay for interactions
     </li>
     <li class="itemize">fixed search panel on left third?
     </li>
     <li class="itemize">search results expand panel downwards dynamically
     </li>
     <li class="itemize">info panel on right third
     </li>
     <li class="itemize">info panel slides in on marker click
     </li>
     <li class="itemize">slides out on map move or zoom
     </li>
     <li class="itemize">panel scrolls on overflow, but not the whole page</li></ul>
<!--l. 78--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.4   </span> <a 
 id="x1-70001.1.4"></a>Info Panel</h5>
     <ul class="itemize1">
     <li class="itemize">css animations
     </li>
     <li class="itemize">place offscreen and disallow scrolling
     </li>
     <li class="itemize">fixed size to screen
     </li>
     <li class="itemize">top layer is a dynamic number of thumbnails for each band in an event
         <ul class="itemize2">
         <li class="itemize">animated and bevelled</li></ul>
     </li>
     <li class="itemize">second layer is the current band information
                                                                  

                                                                  
         <ul class="itemize2">
         <li class="itemize">text over image with transparency fade
         </li>
         <li class="itemize">paragraph after both
         </li>
         <li class="itemize">width is fixed, text on image is pinned to bottom of image, paragraph
         comes after image</li></ul>
     </li>
     <li class="itemize">third layer is a sample music button
         <ul class="itemize2">
         <li class="itemize">includes clickable svg and spotify player that is hidden intially
         </li>
         <li class="itemize">clicking the svg triggers an SMIL animation on parts of the svg, reveals
         the spotify player, and fades the background colour to match the player
         xO
         </li>
         <li class="itemize">clicking play again reverses these animations</li></ul>
     </li>
     <li class="itemize">fourth layer includes event information
         <ul class="itemize2">
         <li class="itemize">first box is location information with link to the songkick page for the
         venue
         </li>
         <li class="itemize">second box includes self made svg of tickets and is clickable to get to
         the ticket purchasing page
         </li>
         <li class="itemize">background image has been modified using gimp and is animated to fade
         on mouse over
         </li>
         <li class="itemize">took a long time to get these boxes in the desired position wewew</li></ul>
     </li></ul>
<!--l. 110--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.5   </span> <a 
 id="x1-80001.1.5"></a>Search Panel</h5>
     <ul class="itemize1">
     <li class="itemize">persistent search box with icon from a custom font
                                                                  

                                                                  
     </li>
     <li class="itemize">the google maps distance matrix api is used on the client side to determine
     how far away events are from the users current location, this is displayed with
     the search
     </li>
     <li class="itemize">a custom date icon was created using html and adds a nice visual to when
     event takes place, this is generated by javascript with the date and month
     injected in to be added to each search result
     </li>
     <li class="itemize">clicking on a search result repositions the map to see where it is and opens
     the relevant info panel</li></ul>
<!--l. 118--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.6   </span> <a 
 id="x1-90001.1.6"></a>Date Filter</h5>
     <ul class="itemize1">
     <li class="itemize">fixed up real nice calendar lib and made pull request n all &#x003C;3
     </li>
     <li class="itemize">looks super dank in the search panel iluvit</li></ul>
<!--l. 124--><p class="noindent" >
   <h5 class="subsubsectionHead"><span class="titlemark">1.1.7   </span> <a 
 id="x1-100001.1.7"></a>Map</h5>
     <ul class="itemize1">
     <li class="itemize">using the google maps api with a custom theme
     </li>
     <li class="itemize">adding markers for each event in our data structure
     </li>
     <li class="itemize">marker onclick opens the info bar for the desired event and centers the event,
     also animated the marker icon using googles animations
     </li>
     <li class="itemize">the marker icons are a custom svg designed by imna herself</li></ul>
                                                                  

                                                                  
<!--l. 133--><p class="noindent" >
   <h4 class="subsectionHead"><span class="titlemark">1.2   </span> <a 
 id="x1-110001.2"></a>Logic</h4>
     <ul class="itemize1">
     <li class="itemize">Initially the info panel is hidden and the map loads with an empty search panel
     overlayed
     </li>
     <li class="itemize">the main script initiates a websocket connection with the server, and once
     both the map and the websocket connection is made, the client sends its
     current map position to the server.
     </li>
     <li class="itemize">This  triggers  the  server  to  send  nearby  events,  which  once  received  are
     visualised on the map as our custom markers.
     </li>
     <li class="itemize">a user can then click a marker which triggers the sidepanel to be animated in and
     its content updated to match the information in the data structure for that
     event
         <ul class="itemize2">
         <li class="itemize">this  involved  creating  a  dynamic  number  of  band  thumbnails  and
         inserting it into the correct position
         </li>
         <li class="itemize">updating the band info box to the first band name and description, as
         well as updating the spotify player with the bands spotify link</li></ul>
     </li>
     <li class="itemize">the event name and location is updated as well as the links to the event page and
     the ticket buying page
     </li>
     <li class="itemize">keyup in the search bar triggers search algorithm on nearby events which generates
     the results html
     </li>
     <li class="itemize">results html is inserted inside a container div that is already there
     </li>
     <li class="itemize">the search algorithm performs a sublime like fuzzy search by not matching
     sequential matches but each character can match any length into the
     text
     </li>
     <li class="itemize">each matched character is given the bold html tag to signify that is the character
     that matched</li></ul>
                                                                  

                                                                  
<!--l. 153--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-120002"></a>Server</h3>
<!--l. 154--><p class="noindent" >The server uses the provided script with modifications. The index is served as a static file
and dynamic content is achieved using Websocket connections between the client and
server. This design choice simplifies the file resource serving logic, reducing the dynamic
parts to message passing.
<!--l. 156--><p class="indent" >   Once the client has initialised the webpage, it sets up a secure Websocket connection
to the server. A secure socket is preferred as non secure sockets are disallowed when
viewing the page over https.
<!--l. 158--><p class="indent" >   The client will query the browser for its current geographical location and when given,
will send this to the server along with a desired date range.
<!--l. 160--><p class="indent" >   The server will receive this data and use it to query the database using a geoNear
query on a <a 
href="https://docs.mongodb.com/manual/core/2dsphere/" >2dsphere</a> index, and a date range query on the event date. The results are
sent to the client.
<!--l. 162--><p class="indent" >   Websockets provide a stream of messages, where a message is either some binary data
or a string. We serialize JSON for sending data between the client and server. When the
client sends its position and desired date range we serialize a data structure that looks
like the following.
                                                                  

                                                                  
   <div class="verbatim" id="verbatim-1">
<span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;{</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;pos:</span><span 
class="cmtt-10">&#x00A0;{</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;lat:</span><span 
class="cmtt-10">&#x00A0;Number,</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;lng:</span><span 
class="cmtt-10">&#x00A0;Number</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;},</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;dateRange:</span><span 
class="cmtt-10">&#x00A0;{</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;from:</span><span 
class="cmtt-10">&#x00A0;Date,</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;to:</span><span 
class="cmtt-10">&#x00A0;Date</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;}</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;}</span>
<span 
class="cmtt-10">&#x00A0;</span><br /><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span><span 
class="cmtt-10">&#x00A0;</span>
</div>
<!--l. 175--><p class="nopar" >
<!--l. 177--><p class="indent" >   The dates aren&#8217;t parsed into JavaScript dates when using a JSON.parse so these are
handled manually for the database queries.
<!--l. 179--><p class="indent" >   As well as giving the client the desired data we have, we also check whether the
database needs updating. The data is collected using a variety of APIs. First we ask
songkick for the area that the user is in, this allows us to check the database to see if we
have checked this area at all/recently. If we haven&#8217;t got an up to date set of events
for this area, we start downloading the events for the area as well as querying
last.fm for the artists biography and picture, spotify for a reference to their
spotify page, and googles reverse geocode api to get the full address of the
venue.
<!--l. 181--><p class="indent" >   For each area we limit the speed of requests in order to avoid rate limiting. Any
returned errors by the APIs are handled graciously. Once complete data about an event is
retrieved, it is stored in the database using an <a 
href="https://docs.mongodb.com/manual/reference/method/db.collection.update/#upsert-option" >upsert</a> on the event title, to either update
an already queried event, or insert as a new event.
     <ul class="itemize1">
     <li class="itemize">three modules are defined, one for db, one for websockets, and one for songkick
     crawling</li></ul>
<!--l. 187--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-130003"></a>Deployment</h3>
     <ul class="itemize1">
     <li class="itemize">by default server connects to a local mongodb instance and runs on the latest
     nodejs.
                                                                  

                                                                  
     </li>
     <li class="itemize">This favours a vps installations on services like digitalocean or aws by simply
     cloning the git repo, performing an npm install and running both mongodb
     and the server script.
     </li>
     <li class="itemize">the site is live at https://smple.uk</li></ul>
<!--l. 194--><p class="noindent" >
   <h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-140004"></a>API</h3>
     <ul class="itemize1">
     <li class="itemize">We made efforts to abide by the api tos by rate limiting and providing * where
     requested
     </li>
     <li class="itemize">songkick-spotify-google-last.fm</li></ul>
    
</body></html> 

                                                                  


